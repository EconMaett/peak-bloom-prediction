---
title: "Japanese cherry blossom dates"
format: 
  html:
    theme: darkly
    code-fold: show
editor: source
---

Original GitHub repository: <https://github.com/safferli/sakura/tree/master>.

Pull data from the research of Professor [Aono](http://atmenv.envi.osakafu-u.ac.jp/aono/aono-e/), who reconstructed the first cherry blossom dates in Japan dating back to the 9th century.

## Load packages

Clear your workspace, load all the necessary R packages for this exercise and define some important parameters.

```{r}
#| label: load-pkgs
#| output: false

library(tidyverse)
library(scales)
library(emojifont)
```

## Load data

Load the cherry blossom data.

```{r}
dta <- read_rds(file = "data/kyoto.rds") |> 
  select(ad, full_flowering_date, full_flowering_date_doy) |> 
  set_names(nm = c("year", "date", "doy")) |> 
  mutate(sakura_emoji = emoji("cherry_blossom"))

tail(dta)
```

## Sakura emoji

Unfortunately, `emoGG::emoji_search("cherry")` does not find a sakura. But it exists in unicode! `1f338` <http://emojipedia.org/cherry-blossom/>

Define some custom colors

```{r}
#| label: define-colors

sakura_pink          <- "#F9E9EC"
cherry_blossom_pink  <- "#FFB7C5"
emojiOne_sakura_pink <- "#FF506E"
emojiOne_light_pink  <- "#FFF0F3"
```

To load the colors into RStudio, you need to call the following functions

```{r}
#| label: load-colors

load.emojifont()

windows()
```

Create a simple plot

```{r}
#| label: plot-sakura-background
#| warning: false

ggplot(data = dta, mapping = aes(x = year, y = doy)) +
  geom_point(colour = "pink2") +
  geom_smooth(method = "loess", formula = "y ~ x", span = 0.1, fill = "#FFB7C5", colour = "darkred") +
  theme_classic()
```

Create a plot with sakuras

```{r}
#| label: plot-sakuras
#| warning: false

ggplot(data = dta, mapping = aes(x = year, y = doy)) +
  geom_text(mapping = aes(label = sakura_emoji, hjust = 0.5, vjust = 0.25), family = "EmojiOne", size = 4, colour = "#FF506E", fill = "#FF506E") +
  geom_smooth(method = "loess", formula = "y ~ x", span = 0.1, fill = "#F9E9EC", colour = "skyblue") +
  scale_x_continuous(
    limits = c(800, 2020),
    breaks = seq(from = 800, to = 2000, by = 100),
    labels = replace(x = seq(from = 800, to = 2000, by = 100), list = seq(from = 2, to = 12, by = 2), values = "")
  ) +
  labs(
    title = "Cherry Bomb",
    subtitle = "Date of Cherry-blossom peak-bloom in Kyoto, Japan, 800AD - 2021",
    caption = "Source: Aono & Kazui (2008), Aono & Saito (2010), Aono (2012)"
  ) +
  theme_classic() +
  theme(
    axis.line = element_line(colour = "black"),
    axis.ticks.x = element_line(colour = "black"),
    panel.grid.major.x = element_blank(),
    panel.grid.major.y = element_line(colour = "darkgrey"),
    plot.caption = element_text(colour = "darkgrey"),
    panel.background = element_blank()
  )
```

## Save plot

Save the plot

```{r}
#| label: save-plot
#| eval: false
#| warning: false

ggsave(
  filename = "images/safferli-cherry-bomb.png",
  dpi = 350,
  width = 12,
  height = 7,
  units = "cm",
  bg = "white"
)
```
